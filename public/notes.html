<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SnapNotes â€¢ Notes</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="h-full bg-gray-50 text-gray-900 antialiased dark:bg-gray-950 dark:text-gray-100">
<header id="app-header" class="sticky top-0 z-40 border-b border-gray-200 bg-white/80 backdrop-blur dark:border-gray-800 dark:bg-gray-900/80"></header>

<main class="mx-auto max-w-5xl px-4 py-8">
  <section class="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm dark:border-gray-700 dark:bg-gray-800">
    <h2 class="mb-4 text-base font-semibold">Notes</h2>
    <div class="flex gap-2 mb-4">
      <input id="qInput" class="w-full rounded-xl border px-3 py-2 dark:bg-gray-800" placeholder="Test" />
      <input id="tagInput" class="w-full rounded-xl border px-3 py-2 dark:bg-gray-800" placeholder="Exact tag.." />
      <button id="refreshBtn" class="rounded-xl bg-indigo-600 px-4 py-2 text-white">Refresh</button>
      <button id="clearBtn" class="rounded-xl bg-white px-4 py-2 ring-1 ring-gray-200 hover:bg-gray-50 dark:bg-gray-900 dark:ring-gray-700">Clear</button>
    </div>
    <div id="notesCount" class="text-xs text-gray-500">0 items</div>
    <div id="notesList" class="mt-4">No notes yet.</div>
  </section>
</main>

<script src="/public/shared.js"></script>
<script>
  App.renderHeader('notes');
  App.ensureAuth();
  const $ = s => document.querySelector(s);
  const qInput = $('#qInput');
  const tagInput = $('#tagInput');
  const notesCount = $('#notesCount');
  const notesList = $('#notesList');

  async function loadNotes() {
    const q = qInput.value.trim();
    const tag = tagInput.value.trim();
    let url = '/notes?';
    if (q) url += `q=${encodeURIComponent(q)}`;
    if (tag) url += `${q ? '&' : ''}tag=${encodeURIComponent(tag)}`;
    try {
      const r = await App.api(url);
      console.log('Notes Response:', r); // Debug
      const items = r.items || []; // Fallback if items undefined
      notesCount.textContent = `${items.length} items`;
      notesList.innerHTML = items.length ? items.map(note => `<p>${note.caption} - ${note.s3Key}</p>`).join('') : 'No notes yet.';
    } catch (e) {
      console.error('Load error:', e);
      App.toast('Load error: ' + e.message);
    }
  }

  $('#refreshBtn').onclick = loadNotes;
  $('#clearBtn').onclick = () => {
    qInput.value = '';
    tagInput.value = '';
    loadNotes();
  };
  loadNotes(); // Initial load
</script>
</body>
</html>